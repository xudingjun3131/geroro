window.AnsPress=_.extend({models:{},views:{},collections:{},loadTemplate:function(a){0==jQuery("#apTemplate").length&&jQuery('<script id="apTemplate" type="text/html"></script>').appendTo("body"),jQuery.get(apTemplateUrl+"/"+a+".html",function(a){var b=jQuery("#apTemplate");b.text(a+b.text()),AnsPress.trigger("templateLoaded")})},getTemplate:function(a){return function(){if(0==jQuery("#apTemplate").length)return"";var b=new RegExp("#START BLOCK "+a+" #([\\S\\s]*?)#END BLOCK "+a+" #","g"),c=b.exec(jQuery("#apTemplate").text());return null==c?"":c[1]?c[1]:void 0}},isJSONString:function(a){try{return jQuery.parseJSON(a)}catch(a){return!1}},ajaxResponse:function(a){if(a=jQuery(a),"undefined"==typeof a.filter("#ap-response"))return console.log("Not a valid AnsPress ajax response."),{};var b=this.isJSONString(a.filter("#ap-response").html());return b&&"undefined"!==b&&_.isObject(b)?b:{}},ajax:function(a){var b=this;a=_.defaults(a,{url:ajaxurl,method:"POST"}),_.isObject(a.data)&&(a.data=jQuery.param(a.data)),a.data="action=ap_ajax&"+a.data;var c=a.success;return delete a.success,a.success=function(d){var e=a.context||null,f=b.ajaxResponse(d);f.snackbar&&AnsPress.trigger("snackbar",f),"function"==typeof c&&(d=jQuery.isEmptyObject(f)?d:f,c(d,e))},jQuery.ajax(a)},uniqueId:function(){return jQuery(".ap-uid").length},showLoading:function(a){AnsPress.hideLoading(a);var b=jQuery(a).data("loadclass")||"",c=jQuery(a).is('input[type="text"]'),d=this.uniqueId(),e=jQuery('<div class="ap-loading-icon ap-uid '+b+(c?" is-text":"")+'" id="apuid-'+d+'"><i></i></div>');jQuery("body").append(e);var f=jQuery(a).offset(),g=jQuery(a).outerHeight(),h=c?40:jQuery(a).outerWidth();return e.css({top:f.top,left:c?f.left+jQuery(a).outerWidth()-40:f.left,height:g,width:h}),jQuery(a).data("loading","#apuid-"+d),"#apuid-"+d},hideLoading:function(a){"all"==a?jQuery(".ap-loading-icon").hide():jQuery(jQuery(a).data("loading")).hide()}},Backbone.Events),_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/\{\{\{([\s\S]+?)\}\}\}/g,escape:/\{\{([^\}]+?)\}\}(?!\})/g},function(a){a.fn.autogrow=function(b){function c(c){var d,e=a(this),f=e.innerHeight(),g=this.scrollHeight,h=e.data("autogrow-start-height")||0;if(f<g)this.scrollTop=0,b.animate?e.stop().animate({height:g},b.speed):e.innerHeight(g);else if(!c||8==c.which||46==c.which||c.ctrlKey&&88==c.which)if(f>h){d=e.clone().addClass(b.cloneClass).css({position:"absolute",zIndex:-10,height:""}).val(e.val()),e.after(d);do g=d[0].scrollHeight-1,d.innerHeight(g);while(g===d[0].scrollHeight);g++,d.remove(),e.focus(),g<h&&(g=h),f>g&&b.animate?e.stop().animate({height:g},b.speed):e.innerHeight(g)}else e.innerHeight(h)}var d=a(this).css({overflow:"hidden",resize:"none"}),e=d.selector,f={context:a(document),animate:!0,speed:50,fixMinHeight:!0,cloneClass:"autogrowclone",onInitialize:!1};return b=a.isPlainObject(b)?b:{context:b?b:a(document)},b=a.extend({},f,b),d.each(function(d,e){var f,g;e=a(e),e.is(":visible")||parseInt(e.css("height"),10)>0?f=parseInt(e.css("height"),10)||e.innerHeight():(g=e.clone().addClass(b.cloneClass).val(e.val()).css({position:"absolute",visibility:"hidden",display:"block"}),a("body").append(g),f=g.innerHeight(),g.remove()),b.fixMinHeight&&e.data("autogrow-start-height",f),e.css("height",f),b.onInitialize&&e.length&&c.call(e[0])}),b.context.on("keyup paste focus",e,c),d},jQuery.fn.apScrollTo=function(b,c){var d=a(this).scrollTop()-a(this).offset().top;return a("html, body").animate({scrollTop:a(this).offset().top},void 0==c?1e3:c),void 0!=b&&a(this).animate({scrollTop:d+a(b).offset().top},void 0==c?1e3:c),this},AnsPress.views.Snackbar=Backbone.View.extend({id:"ap-snackbar",template:'<div class="ap-snackbar<# if(success){ #> success<# } #>">{{message}}</div>',hover:!1,initialize:function(){AnsPress.on("snackbar",this.show,this)},events:{mouseover:"toggleHover",mouseout:"toggleHover"},show:function(a){var b=this;this.data=a.snackbar,this.data.success=a.success,this.$el.removeClass("snackbar-show"),this.render(),setTimeout(function(){b.$el.addClass("snackbar-show")},0),this.hide()},toggleHover:function(){clearTimeout(this.hoveTimeOut),this.hover=!this.hover,this.hover||this.hide()},hide:function(){var a=this;a.hover||(this.hoveTimeOut=setTimeout(function(){a.$el.removeClass("snackbar-show")},2e3))},render:function(){if(this.data){var a=_.template(this.template);this.$el.html(a(this.data))}return this}});var b=new AnsPress.views.Snackbar;a("body").append(b.render().$el)}(jQuery),jQuery(document).ready(function(a){a(document).click(function(b){b.stopPropagation(),a(b.target).is(".ap-dropdown-toggle")||a(b.target).closest(".open").is(".open")||a(b.target).closest("form").is("form")||a(".ap-dropdown").removeClass("open")}),a("body").delegate(".ap-dropdown-toggle, .ap-dropdown-menu > a","click",function(b){b.preventDefault(),a(".ap-dropdown").not(a(this).closest(".ap-dropdown")).removeClass("open"),a(this).closest(".ap-dropdown").toggleClass("open")}),a("[ap-subscribe]").click(function(b){b.preventDefault();var c=a(this),d=JSON.parse(c.attr("ap-query"));d.ap_ajax_action="subscribe",AnsPress.ajax({data:d,success:function(a){a.count&&c.next().text(a.count),a.label&&c.text(a.label)}})}),a("body").delegate(".ap-droptogg","click",function(b){b.preventDefault(),a(this).closest(".ap-dropdown").removeClass("open"),a(this).closest("#noti-dp").hide()}),a("body").delegate("[ap-ajax-btn]","click",function(b){b.preventDefault();var c=a(this),d=JSON.parse(c.attr("ap-query"));AnsPress.showLoading(c),AnsPress.ajax({data:d,success:function(a){AnsPress.hideLoading(b.target),"undefined"!=typeof a.btn&&a.btn.hide&&c.hide(),"undefined"!=typeof a.cb&&AnsPress.trigger(a.cb,a)}})})});